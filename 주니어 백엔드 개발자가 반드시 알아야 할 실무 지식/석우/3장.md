# 3장 정리

## 3장 성능을 좌우하는 DB 설계와 쿼리.

- 성능과 DB
- 인덱스 설계
- 조회 성능 개선 방법
- 주의 사항

### **성능을 좌우하는 DB 설계와 쿼리 정리**

> DB 성능 문제

- 대부분의 서비스 성능 문제는 DB 부하에서 시작
- 풀 스캔(Full Scan)은 데이터가 많아질수록 CPU 사용률 급등, 응답 지연의 원인
- 인덱스가 없거나 잘못 설계된 경우 자주 호출되는 쿼리에서 풀 스캔이 발생할 수 있음

```
풀 스캔: WHERE 조건에 맞는 인덱스가 없어 테이블 전체를 탐색하는 것
```

> 인덱스 설계 핵심

- 조회 트래픽 중심으로 설계(대부분의 시스템은 읽기 비율이 높음)
- 데이터 양과 트래픽 규모에 따라 인덱스 필요 여부가 달라짐(데이터가 작으면 인덱스가 불필요 하지만 데이터의 양이 많아지면 인덱스가 반드시 필요)

> 단일 인덱스 VS 복합 인덱스

- 단일 인덱스 : 하나의 컬럼
- 복합 인덱스 : 여러 컬럼의 조합
- 사용자당 데이터가 많을수록 복합 인덱스가 유리
- 인덱스가 많다고 좋은 게 아니라 필요한 만큼만 사용

```
인덱스는 조회는 빠르게 하지만 insert/update/delete 시에는 부담(추가 시간)과 메모리/디스크 사용량 증가
```

> 커버링 인덱스

- 쿼리에 필요한 모든 컬럼이 인덱스에 포함되어 있으며 실제 데이터(테이블)를 읽지 않고 인덱스만으로 조회 가능(매우 빠르다)

> 불필요한 인덱스 방지

- 비슷한 인덱스 여러 개 만들지 말 것(동일 컬럼 중복 인덱스는 효과 없음 관리 비용만 증가)
- 새 쿼리 작성 전 기존 인덱스 재활용 가능성 검토
- 약간의 요구사항 변경으로 기존 인덱스 활용 가능

> 조회 성능 개선 기법

1. 미리 집계하기 : 조회 시 count, sum 등을 매번 계산하지 말고 insert/update 시 미리 집계값 컬럼을 업데이트
   - 실시간 약간의 오차는 허용 정확한 값은 별도 통계에서 재계산 가능
   - 트랜잭션 동시성(원자성)은 주의 필요
2. 페이지네이션 개선
   - OFFSET이 큰 쿼리는 매우 느림
   - 마지막 읽은 ID 기준으로 다음 페이지 조회
3. 시간 기준으로 조회 범위 제한
   - 뉴스, 주문, 로그 등은 최근 데이터만 조회하도록 제한하면 성능 향상
   - 최신 데이터 위주로 캐시 효율도 높아짐

#### 결론

3장은 DB 인덱스 설계와 쿼리 구조를 어떻게 짜느냐가 서비스의 속도와 확장성을 결정한다는 점을 강조한다.
조회 패턴에 맞게 인덱스를 설계하고, 불필요한 인덱스를 줄이며, 커버링 인덱스를 활용해 성능을 끌어올리는 방법이 잘 정리되어 있다.
또한 쿼리 구조 자체를 개선해 최신 데이터만 조회하거나, 미리 집계한 컬럼을 활용해 효율적으로 데이터를 처리하는 방식도 함께 설명하고 있다.
