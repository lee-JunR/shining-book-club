# 7장 정리

## 7장 IO 병목, 어떻게 해결하지.

- 네트워크 IO와 CPU
- 가상 스레드
- 논블로킹 IO

### ** IO 병목, 어떻게 해결하지 **

서버 처리량에 큰 영향을 미치는 IO와 성능의 관계를 이해하고 IO 대기로 인한 자원 비효율을 해소하기 위한 두 가지 핵심 방법인 가상 스레드와 논블로킹 IO에 대해 설명한다.

## IO 병목 현상 및 원인

```
• IO 대기 (Blocking): 서버 프로그램은 DB, 외부 API 등 다양한 구성 요소와 네트워크를 통해 데이터를 주고받습니다. 데이터를 주고받는 I/O 과정(예: write(), read()) 동안, 코드를 실행하는 스레드는 데이터 전송이 완료될 때까지 아무 작업도 하지 않고 대기 상태(블로킹)가 된다.

• 자원 비효율: 네트워크 연동이 많은 프로그램은 전체 실행 시간의 90% 이상을 I/O 대기에 사용할 수 있다. 스레드가 I/O 대기로 멈춰 있을 때, CPU도 유휴 시간이 생기며 동시 스레드가 증가하면 컨텍스트 스위칭에 따른 CPU 낭비와 메모리 사용량 증가로 이어져 자원 효율이 떨어진다.
```

## 해결 전략

```
경량 스레드(가상 스레드)를 활용한 방법이 나오는데 가상 스레드가 블로킹 연산을 만나면 플랫폼 스레드로부터 언마운트되고 플랫폼 스레드는 대기 중인 다른 가상 스레드를 실행하여 CPU  유후 시간을 줄일 수 있다.

논블로킹 IO 사용하여 입출력이 끝날 때까지 스레드가 대기하지 않으면 읽을 데이터가 없으면 바로 리턴하고 다음 코드를 실행하도록 서버 구조를 변경하는 방식이 있다. 하지만 논블로킹 IO는 코드가 복잡해지고 유지보수 난이도가 올라가는 단점이 존재한다.
```

## 선택 기준

```
IO 중심 작업에서 코드 수정 없이 성는 개선이 필요하다면 가상 스레드를 적용하거나 폭발적인 사용자 증가나 극한의 처리량이 필요할 때는 논블로킹 IO를 적용해서 사용해야 한다.
```

#### 결론

어떤 방법을 선택할지는 성능 문제의 존재 여부 또는 문제가 네트워크 IO와 관련되었는지 여부 그리고 구현 변경의 가능성을 종합적으로 검토하여 결정해야 한다.

문제가 없다면 불필요한 복잡한 구현을 도입할 필요는 없으며 이러한 IO 처리 방식의 선택은 마치 건축 설계와 같다.

일반적인 건물(낮은 트래픽)에는 일반적인 건축 자재(플랫폼 스레드 기반 블로킹 IO)로 충분하다.

하지만 마천루(고트래픽)를 지을 때는 더 가벼우면서 효율적인 자재(가상 스레드)를 사용해야 하며 극한의 효율을 위해 구조 자체를 혁신적으로 바꿔야(논블로킹 IO) 할 때도 있는 것이다.
