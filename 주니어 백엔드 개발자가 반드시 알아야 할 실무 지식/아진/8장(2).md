# 8장. 실무에서 꼭 필요한 보안 지식

---

## 1. HMAC을 이용한 데이터 검증

### ● HMAC이란?
- **HMAC(Hash-based Message Authentication Code)**  
  해시 함수와 비밀 키를 조합해 **메시지의 위변조 여부와 발신자 인증**을 동시에 확인할 수 있는 기술.
- 일반 해시(SHA-256 등)와 달리 **비밀 키를 알고 있는 당사자만** 올바른 MAC을 생성할 수 있다.

### ● HMAC이 보장하는 보안 요소
1. **메시지 무결성**
  - 전송 중 데이터가 바뀌지 않았음을 확인.
  - MAC이 다르면 중간자가 데이터를 변조했다는 의미.
2. **인증(Authentication)**
  - 동일한 MAC을 생성할 수 있는 사람은 **비밀 키를 알고 있는 사람**뿐이므로 발신자를 확인할 수 있다.

### ● 동작 흐름
1. 발신자: `메시지 + 비밀 키` → HMAC 계산 → 메시지 + MAC 전달
2. 수신자: 같은 방식으로 MAC 재계산
3. 두 MAC 값이 일치하는지 비교
4. 다르면 **위변조 또는 잘못된 발신자**로 판단

### ● 장점
- 구현이 단순하고 빠름
- 동일한 해시 기반 검증보다 보안성이 높음

### ● 단점
- **비밀 키 관리가 매우 중요함**
- 키가 외부로 유출되면 인증 기능이 완전히 무력화됨

---

## 2. 방화벽(Firewall)으로 필요한 트래픽만 허용하기

### ● 방화벽의 역할
네트워크를 오가는 트래픽을 필터링하여  
**허용해야 할 트래픽만 통과시키고 나머지는 차단**하는 보안 장치.

### ● 방화벽의 두 가지 트래픽 제어

#### ① 인바운드(Inbound)
- **외부 → 내부**로 들어오는 요청
- 서비스 운영 시 가장 신중해야 하는 구간
- 예:
  - 일반 사용자 API:  
    외부 모든 IP → 서버A:443 허용
  - 관리자 API:  
    회사 내부망 IP → 서버B:443만 허용
- 이렇게 설정하면 외부인이 관리자 API에 접근할 수 없음

#### ② 아웃바운드(Outbound)
- **내부 → 외부**로 나가는 요청
- 개발 환경에서 흔히 전체 허용하지만,  
  실무에서는 **정해진 외부 서비스만 허용**해야 안전.
- 예: DB 서버는 오직 특정 외부 백업 서버로만 나갈 수 있도록 제한

### ● 방화벽이 차단하는 대표 공격
- **DDoS(분산 서비스 거부 공격)**  
  여러 위치에서 대량의 요청을 보내 서버를 느리게 하거나 중단시키는 공격
  - 예: Dyn DNS 대규모 마비 사건
- 포트 스캔, 의심 트래픽 차단 기능도 제공

---

## 3. 감사 로그(Audit Log) 남기기

### ● 감사 로그란?
- 특정 보안 관련 사건, 변경 사항, 데이터를 **추적 가능한 형태로 기록**한 로그
- 규제 산업(의료, 금융, 공공기관)에서 특히 중요

### ● 주로 기록하는 내용
- 사용자 로그인 및 로그아웃 기록
- 비밀번호 초기화 등 계정 설정 변경
- 의료진이 특정 환자 기록을 열람한 이력
- 문서(계약서 등) 수정 히스토리

### ● 감사 로그 vs 일반 로그
| 구분 | 감사 로그 | 일반 로그 |
|------|-----------|-----------|
| 목적 | 정책 준수, 책임 추적 | 버그 해결, 오류 분석 |
| 변경 가능 여부 | **임의 수정 불가(또는 기록 남김)** | 일반적으로 자유 수정 가능 |
| 보관 규칙 | 법/정책에 따라 엄격함 | 서비스 상황에 따라 자율적 |

---

## 4. 비정상 접근 처리

### ● 비정상 접근으로 판단하는 기준
1. 평소와 다른 **지리적 위치**에서 로그인
2. 평소 사용하지 않던 **기기**에서 로그인
3. 로그인 **여러 번 실패**
4. 짧은 시간 안에 **여러 지역에서 동시에 로그인 시도** 발생
5. API 요청 패턴이 기존과 동떨어진 경우

### ● 대응 방식
- 여러 번 로그인 실패 시 **계정 잠금**  
  → 자동화된 무차별 대입(브루트 포스) 공격 차단
- 의심 활동이 발생하면
  - 추가 인증(MFA) 요구
  - 일시적으로 세션 만료
  - 관리자에게 경고 발송

### ● 브루트 포스 공격
- 가능한 모든 조합을 시도하여 암호를 찾아내려는 방식
- 모든 암호가 이론적으로 이 공격에서 자유롭지 않음
- 그래서
  - 계정 잠금
  - 요청 속도 제한
  - CAPTCHA 사용  
    등 다양한 방어 기법을 사용한다.

---

## 5. 시큐어 코딩

### ● SQL 인젝션(SQL Injection)
- 공격자가 입력 값에 악성 SQL을 삽입해  
  DB 데이터를 조회, 수정, 삭제할 수 있는 공격
- 매우 흔하며, OWASP Top 10에도 포함되는 주요 취약점

### ● 방지 방법
- **Prepared Statement(미리 컴파일된 SQL)**  
  → 입력 값에 포함된 특수문자를 안전하게 처리하여 SQL 구문 삽입을 막아줌

### ● 시큐어 코딩 시 신경 써야 할 항목
- 입력 값 검증(Validation)
- 개인정보/민감정보 암호화
- 에러 메시지에 DB/서버 정보 노출 금지
- HTTPS 등 안전한 통신 사용
- CORS 정책 설정
- CSRF 방지 토큰 적용
