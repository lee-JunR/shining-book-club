## DB 성능 최적화 가이드
### 1. 가장 큰 문제: 풀 스캔(Full Scan)
문제 상황

데이터가 적을 때는 괜찮지만, 데이터와 트래픽이 늘면 DB CPU 사용률이 급증하고 서비스 전체가 느려집니다.

핵심 해결책: 인덱스 설계
인덱스 설계 원칙
조회 패턴 분석

자주 사용하는 WHERE 조건에 맞춰 인덱스를 만듭니다.
예: 카테고리별 게시글 조회가 많다면 → category 칼럼에 인덱스

단일 vs 복합 인덱스

단일 인덱스: 하나의 칼럼만 사용
복합 인덱스: 여러 칼럼을 묶어서 사용
예: 특정 사용자의 특정 날짜 활동 조회 → (userId, activityDate) 복합 인덱스

선택도(Selectivity) 고려

고유한 값이 많은 칼럼일수록 인덱스 효율이 좋습니다.
좋은 예: 사용자 ID, 주문번호
나쁜 예: 성별(남/여 2가지만), 활성 상태(true/false)

커버링 인덱스

쿼리에 필요한 모든 칼럼을 인덱스에 포함시키면, 실제 테이블 데이터에 접근하지 않아 속도가 크게 빨라집니다.

--------------------------------
## 주의사항

---------------------------------
인덱스는 조회 속도는 높이지만, INSERT/UPDATE/DELETE 시 부하를 유발하므로 필요한 만큼만 만들어야 합니다.


### 2. 추가 성능 개선 방법
미리 집계하기

실시간으로 COUNT, SUM을 계산하면 느립니다.
답변 수, 좋아요 수 등을 별도 칼럼에 저장
데이터 변경 시마다 값만 업데이트

ID 기준 목록 조회 (커서 기반 페이지네이션)

페이지 번호(OFFSET)를 쓰면 뒤로 갈수록 느려집니다.
마지막 조회 ID를 기준으로 다음 데이터를 가져오는 방식이 효율적
예: WHERE id > 12345 LIMIT 20

조회 범위 제한

시간 기준으로 범위를 제한하면 처리 데이터가 줄어듭니다.
예: "최근 6개월", "일자별 조회"

전체 개수 세지 않기

COUNT(*)로 전체 개수를 세는 쿼리는 데이터가 많으면 큰 부하를 줍니다.
가능하면 "더보기" 방식으로 전환하거나, 대략적인 수만 표시

오래된 데이터 관리

정기적으로 삭제하거나 별도 저장소로 이동시켜 현재 DB의 데이터 양을 일정하게 유지합니다.


### 3. 인프라 확장 방법
DB 장비 확장

수직 확장: CPU, 메모리 사양 업그레이드
수평 확장: 읽기 전용 복제 DB 추가로 부하 분산

캐시 서버 도입

Redis 같은 캐시를 사용하면 DB 트래픽을 획기적으로 줄일 수 있습니다.


### 4. 운영 시 주의사항
쿼리 타임아웃 설정

특정 쿼리가 너무 오래 실행되어 전체 시스템을 느리게 만드는 것을 방지합니다.

트랜잭션 관리

데이터 변경은 반드시 트랜잭션 안에서 처리하여 데이터 일관성을 유지합니다.
특히 외부 API 호출이 섞여있을 때 롤백 범위를 신중하게 설계

테이블 구조 변경 주의

데이터가 많은 테이블의 구조를 변경하면 테이블 전체를 복사하는 과정에서 서비스가 장시간 중단될 수 있습니다.

DB 최대 연결 개수 확인

API 서버를 증설할 때 DB의 최대 연결 개수(connection pool)를 초과하지 않는지 확인해야 합니다.


## 핵심 요약

인덱스를 제대로 설계하는 것이 가장 중요합니다
실시간 집계 대신 미리 계산하고, 조회 범위를 제한합니다
커서 기반 페이지네이션으로 대용량 목록 조회를 최적화합니다
한계에 도달하면 캐시 서버 도입과 DB 확장을 고려합니다
트랜잭션 관리와 테이블 변경 작업은 신중하게 진행합니다