## 2장: 테스트와 가독성


### 1. 처리량과 응답 시간

- **응답 시간(TTFB, TTLB)**은 사용자 요청에 대한 첫 바이트 도착과 마지막 바이트 도착 시간으로, 네트워크 상태와 응답 크기에 영향을 받음
- **처리량(TPS/RPS)**은 단위 시간당 처리 가능한 요청 수로, TPS 한계를 넘으면 지연 발생
- 성능 문제 시 우선 DB 연동과 외부 API 호출 구간을 집중 점검해야 함

### 2. 서버 성능 개선 기초

- **병목지점(bottleneck)** 발견을 위해 모니터링 툴과 로그 분석 활용
- **스케일링 전략:**
    - **수직 확장(Scale-Up)**: 서버 자원(메모리, CPU) 업그레이드, 빠르지만 비용 부담 큼
    - **수평 확장(Scale-Out)**: 서버 대수 증가, 무턱대고 늘리면 DB 병목 악화 가능, 병목 파악 후 결정 필요
- **DB 커넥션 풀:** DB 연결 생성 비용 절감을 위해 미리 커넥션을 만들어 재사용 
    - **커넥션 풀 크기**: 자원 낭비와 대기 시간 최소화 위한 적정 커넥션 수 설정, 동시 처리 가능한 커넥션 수 제한
    - **커넥션 대기 시간**: 요청 시 커넥션이 풀에서 획득될 때 기다리는 최대 시간, 시간 초과 시 오류 발생, 너무 길면 응답 지연 초래
    - **최대 유휴 시간, 유효성 검사, 최대 유지 시간**: 
        - 최대 유휴 시간: 사용하지 않는 커넥션이 풀에 유휴 상태로 남아 있을 수 있는 최대 시간
        - 유효성 검사: 커넥션 사용 전/후 혹은 유휴 중 연결 상태를 검증해 끊어진 연결 제거 (예: SELECT 1 쿼리 수행)
        - 최대 유지 시간: 커넥션이 풀 내에서 지속될 수 있는 최대 시간으로, 네트워크 타임아웃보다 짧게 설정해 오래된 연결 삭제
        - 이 세 가지 설정으로 안정적인 커넥션 풀 운영 및 불안정한 연결 방지
- **서버 캐시:**  
    - **캐시 적중률과 삭제 규칙**: 
        - **적중률** = 캐시에 요청한 데이터 중 실제 캐시에서 제공한 비율로, 높을수록 DB 부하 감소 및 성능 향상
        - 캐시 용량 한정으로 인해 새 데이터 저장시 오래된 데이터 삭제 필요
        - **삭제 규칙**:
            - LRU (Least Recently Used): 가장 오래된 데이터 삭제 
            - LFU (Least Frequently Used): 가장 적게 사용된 데이터 유지
            - FIFO (First In First Out): 먼저 저장된 데이터부터 삭제
        - 유효 시간(만료시간) 설정으로 오래된 데이터 자동 제거
    - **로컬 캐시 vs 리모트 캐시**: 
        - **로컬 캐시**: 애플리케이션 내 저장, 접근 속도 빠름, 메모리 사용 한계
        - **리모트 캐시**: 별도 서버나 클라우드에 저장해 여러 서비스 공유 가능, 네트워크 지연과 단일 장애점 주의 필요
    - **캐시 사전 적재**: 사전 생성된 캐시 사용으로 순간 트래픽 급증 대비
    - **캐시 무효화**: 데이터 변경 시 오래된 캐시 제거 또는 갱신 필요, 무효화 전략 중요: TTL 만료, 명시적 삭제, 버전 관리 등
    - **가비지 컬렉터와 메모리 사용**: 캐시된 객체도 JVM의 가비지 컬렉터 대상, 캐시 크기 조절로 메모리 과다 사용 방지 필요
    - **응답 데이터 압축**: 네트워크 전송 대역폭 절감을 위해 Gzip 등 압축 사용, 압축으로 전송 지연 최소화하며 응답속도 개선
    - **정적 자원과 브라우저 캐시, CDN**: 
        - 정적 자원(CSS, JS, 이미지)은 CDN 활용으로 네트워크 부하와 응답 시간 절감 가능
        - 브라우저 캐시 설정(Cache-Control, ETag 등)으로 재요청 최소화
        - CDN과 브라우저 캐시를 적절히 조합해 네트워크 부하 감소와 사용자 경험 향상
- **대기 처리:** 대기 큐 사용으로 요청 순차 처리


## 결론

이번 주차에서는 서비스가 느려졌을 때 어디서부터 점검하고 개선해야 하는지 단계별 접근법을 배웠습니다. 중요한 점은 처음부터 완벽한 해결책을 찾지 말고, 성능 병목 구간을 정확히 찾아내고 가장 간단한 방법부터 시작해서 점진적으로 문제를 개선하는 것이 중요하다는 것을 다시 한번 깨달았습니다. 또한 적절한 캐싱, 커넥션 풀 설정, 타임아웃 조절 같은 기본적인 요소들을 배우면서 우리 시스템에 어떻게 적용할 수 있을지 생각해보게 되었습니다.