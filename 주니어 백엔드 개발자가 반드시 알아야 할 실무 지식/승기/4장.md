## 4장: 외부 연동이 문제일 때 살펴봐야 할 것들


### 1. 외부 연동 문제

### 2. 타임아웃과 재시도 

- **연결 타임아웃**(3~5초)과 **읽기 타임아웃**(5~30초) 설정으로 무한 대기 및 병목 방지, 타임아웃 적절 조절 후 모니터링과 조정 필요
- 단순 조회, 연결 타임아웃이나 **멱등성**이 보장되는 작업에 한해 **재시도** 적용, 재시도 시 중복 실행, 데이터 무결성 문제 예방 필요
- 재시도 횟수와 간격: 무한 반복 아닌 적정 횟수 지정, 재시도 간격은 점진적 지연 권장
- **재시도 폭풍(Retry Storm) 안티패턴**: 동시에 대량 재시도 발생해 시스템 과부하 유발

### 3. 동시 요청 제한과 서킷 브레이커

- 외부 서비스 요청 과다 시 부하 증가 및 실패 가능성 커짐, 적절한 **동시 요청 수 제한**으로 안정성 확보
- **벌크헤드(Bulkhead)**: 외부 연동 호출 시 자원 격리(스레드 풀, 커넥션 풀 분리)로 한 구간 장애가 시스템 전체 영향 주지 않도록 분리
- **서킷 브레이커**: 외부 연동 장애 시 **빠른 실패** 처리로 시스템 전체 장애 방지, 장애 복구 후 자동 재접속 및 상태 점검 기능 포함

### 4. DB와 외부 연동

- 외부 API 호출 성공, DB 실패 시 롤백 전략과 보상 처리 필요, 외부 연동 취소 API 활용해 상태 복구 관리
- 외부 연동 지연 시 DB 커넥션 풀 고갈 문제 발생 가능, 오래 대기하는 커넥션이 풀을 점유해 신규 요청 대기 증가

### 5. HTTP 커넥션 풀

- **HTTP 커넥션 풀 크기, 풀로부터 HTTP 커넥션 획득 대기 시간, HTTP 커넥션 유지 시간(keep alive)** 적절하게 조절

### 6. 이중화 

- 외부 시스템 장애 대비 연동 서비스 이중화 구성